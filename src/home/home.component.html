<!-- todo-list.component.html -->
<div class="todo-container">
    <h1> Todo List</h1>
    <h2> {{userName}}</h2>
    <div class="sort-todo">
        <div class="form-group">
            <p><b>Sort Task By :</b></p>
        </div>
        <div class="form-group">
            <label for="task">Priority</label>
            <select id="priority" [(ngModel)]="sortLanding.priority" placeholder="Priority">
                <option value="none">none</option>
                <option value="ASC">Low to High</option>
                <option value="DESC">High to Low </option>
            </select>
        </div>
        <div class="form-group">
            <label for="taskdescription">Creation Date</label>
            <select id="priority" [(ngModel)]="sortLanding.date" placeholder="Priority">
                <option value="none">none</option>
                <option value="ASC">Oldest</option>
                <option value="DESC">Earliest </option>
            </select>
        </div>
        <div class="form-group">
            <label for="taskdescription">Is Completed</label>
            <input type="checkbox" [(ngModel)]="sortLanding.select">
        </div>
        <div class="form-group">
            <button class="add-button" (click)="refreshPage()">Ok</button>
        </div>

    </div>
    <div class="sort-todo">
        <div class="form-group">
            <p><b>Sort Task By :</b></p>
        </div>
        <div class="form-group">
            <label for="task">Search by Task Name</label>
            <input type="text" id="task" [(ngModel)]="sortLanding.searchTerm" placeholder="Search">
        </div>
        <div class="form-group">
            <button class="add-button" (click)="refreshPage()">Search</button>
        </div>
        <div class="form-group">
            <button class="add-button" (click)="refreshPage()">All</button>
        </div>

    </div>

    <div class="add-todo">
        <div class="form-group">
            <label for="task">Task:</label>
            <input type="text" id="task" [(ngModel)]="newtodoItem.taskName" placeholder="Task">
        </div>
        <div class="form-group">
            <label for="taskdescription">Task Description:</label>
            <input type="taskdescription" id="taskdescription" [(ngModel)]="newtodoItem.taskDescription"
                placeholder="Task Description">
        </div>

        <div class="form-group">
            <input matInput [matDatepicker]="picker" [(ngModel)]="newtodoItem.expireDateTime">
            <mat-datepicker-toggle matSuffix [for]="picker"></mat-datepicker-toggle>
            <mat-datepicker #picker></mat-datepicker>
        </div>


        <div class="form-group">
            <label for="priority">Priority:</label>
            <select id="priority" [(ngModel)]="newtodoItem.priorityId" placeholder="Priority">
                <option *ngFor="let priority of prioritiesFromApi" [value]="priority.value">
                    {{ priority.name }}
                </option>
            </select>
        </div>

        <button class="add-button" *ngIf="isAddButtonVisible" (click)="addTodo()">Add</button>
        <button class="edit-button" *ngIf="isEditButtonVisible" (click)="updateTodoItem()">Save</button>
        <button class="delete-button " *ngIf="isEditButtonVisible" (click)="toggleButtons()">Cancel</button>

    </div>


    <table class="todo-table">
        <thead>
            <tr>
                <th>Task Name</th>
                <th>Task Description</th>
                <th>Create Date</th>
                <th>Due Date</th>
                <th>Priority</th>
                <th>Status</th>
                <th>Action</th>
            </tr>
        </thead>
        <tbody>
            <tr *ngFor="let todo of todoItems; let i = index" [ngClass]="{ 'completed': todo.status }">
                <td>{{ todo.taskName }}</td>
                <td>{{ todo.taskDescription }}</td>
                <td>{{ todo.creationDateTime.toLocaleDateString('en-US', { day: 'numeric', month: 'short', year:
                    'numeric'
                    }) }}</td>
                <td>{{ todo.expireDateTime.toLocaleDateString('en-US', { day: 'numeric', month: 'short', year: 'numeric'
                    }) }}</td>
                <td>{{ todo.priorityName }}</td>
                <td>
                    <input type="checkbox" [(ngModel)]="todo.status" (change)="updateTodoItemStatus(i)">
                </td>
                <td>
                    <button class="edit-button" (click)="editTodo(i)">Edit</button>
                    <button class="delete-button" (click)="deleteTodoItem(i)">Delete</button>

                </td>
            </tr>
        </tbody>
    </table>

</div>